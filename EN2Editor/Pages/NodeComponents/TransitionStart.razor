@using EN2Editor.Model.Selection
@using Models
@using EN2Editor.Model
@namespace NodeComponents
@inject SelectionManager selectionManager
@inject NodeModelManager nodeModelManager
@inject IJSRuntime jsRuntime

<div>
    <img src="Icons/TransitionPoint.png" height="16px" style="float:right; margin-right: 2px"
         @onmousedown="OnMouseDown"
         draggable="false"/>
</div>

@code {

    private async Task OnMouseDown(MouseEventArgs evt) {
        Rectangle rect = await jsRuntime.InvokeAsync<Rectangle>("helpers.getBoundingClientRectangle", "CanvasID");
        
        LinkModel linkModel = new LinkModel {
            StartX = evt.ClientX,
            StartY = evt.ClientY,
            CanvasOffSetX = (int)rect.Left,
            CanvasOffSetY = (int)rect.Top
        };
        nodeModelManager.Links.Add(linkModel);

        selectionManager.DraggedLink = linkModel;
        selectionManager.InitialX = evt.ClientX;
        selectionManager.InitialY = evt.ClientY;
        selectionManager.LastX = evt.ClientX;
        selectionManager.LastY = evt.ClientY;
        Console.WriteLine("Start transition");
    }

}